---
title: "Introduction Exploring Data with R"
author: "Professor Di Cook, Econometrics and Business Statistics, Monash University"
date: "NZSA/ORSNZ 2016"
output:
  ioslides_presentation
css:
  my_css.css
---

## SETUP

- Point your web browser to [https://github.com/dicook/NZSAORSNZ16_workshop](https://github.com/dicook/NZSAORSNZ16_workshop)
- Download the repo, using "Download ZIP"

## WORKING DIRECTORY

- Unzip the files
- Open RStudio
- Create a new PROJECT in the directory you just created 

## GETTING STARTED

- Open the "index.Rmd" file in the "1-intro" folder
- Click "KnitHTML", which will compile the file into the slides

## Outline

- <font color="#7c8a1a"> Session 1: Motivation, why and how to think about data, and getting started with R</font>
- Session 2: Making basic plots, grammar of graphics, good practices
- Session 3: Advanced graphics, layering, using maps

```{r setup, include = FALSE}
library("knitr")
opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  error = FALSE,
  cache = FALSE,
  fig.height = 2,
  fig.width = 5,
  fig.caption = FALSE,
  collapse = TRUE,
  comment = "#>"
)
options(digits=2)
library("rmarkdown")
library("devtools")
library("readr")
library("tidyr")
library("ggplot2")
library("ggthemes")
library("gridExtra")
library("dplyr")
library("lubridate")
library("GGally")
library("rworldmap")
library("ggmap")
library("scales")
library("dichromat")
library("RColorBrewer")
library("viridis")
library("purrr")
library("broom")
library("timeDate")
library("haven")
library("boot")
library("plotly")
```


## These Slides

- This is a "live" document
- Code and explanations together
- Run the software to make the calculations on the data, and produce nice presentation, or Word or pdf or html document

## About R?

- **"R has become the most popular language for data science and an essential tool for Finance and analytics-driven companies such as Google, Facebook, and LinkedIn."** [Microsoft 2015](http://www.revolutionanalytics.com/what-r)
- Top 5 programming languages according to IEEE
- There are now 9605 contributed packages

```{r, eval = FALSE, echo = FALSE}
# devtools::install_github("metacran/crandb")
# pkgs <- crandb::list_packages(limit = 999999)
# length(pkgs)
# [1] 7330
```

## Relation between R and RStudio

[From Julie Lowndes](http://jules32.github.io/resources/RStudio_intro/):

*If R were an airplane, RStudio would be the airport, providing many, many supporting services that make it easier for you, the pilot, to take off and go to awesome places. Sure, you can fly an airplane without an airport, but having those runways and supporting infrastructure is a game-changer.*

## The RStudio IDE

- Source editor: (1) Docking station for multiple files, (2) Useful shortcuts ("Knit"),     (3) Highlighting/Tab-completion, (4) Code-checking (R, HTML, JS), (5) Debugging features
-  Console window: (1) Highlighting/Tab-completion, (2) Search recent commands
- Other tabs/panes:  (1) Graphics,  (2) R documentation, (3) Environment pane,   (4) File system navigation/access,  (5) Tools for package development, git, etc

## What is R Markdown?

- From the [R Markdown home page](http://rmarkdown.rstudio.com/):

R Markdown is an authoring format that enables easy creation of dynamic documents, presentations, and reports from R. It combines the core syntax of __markdown__ (an easy-to-write plain text format) __with embedded R code chunks__ that are run so their output can be included in the final document. R Markdown documents are fully reproducible (they can be automatically regenerated whenever underlying R code or data changes).

## RStudio Cheatsheets

- [https://www.rstudio.com/resources/cheatsheets/](https://www.rstudio.com/resources/cheatsheets/)
    - RStudio IDE
    - RMarkdown
    - Data visualisation with ggplot2
    - Data wrangling with tidyr and dplyr
- 
- Also see [Garret Grolemund's list of software](https://github.com/rstudio/RStartHere)



## Getting data

Data can be found in R packages

```{r}
data(economics, package = "ggplot2")
# data frames are essentially a list of vectors
str(economics)
```

These are not usually kept up to date but are good for practicing your analysis skills on.

## Getting Data

Or in their own packages

```{r}
library(gapminder)
str(gapminder)
```

More contemporary sets here, but not updated frequently.

## Getting Data

I primarily use the `readr` package for reading data now. It mimics the base R reading functions but is implemented in `C` so reads large files quickly, and it also attempts to identify the types of variables.

```{r}
ped <- read_csv("../data/Pedestrian_Counts.csv")
kable(head(ped))
```

Pulling data together yourself, or compiled by someone else.

## Your Turn

![](lorikeets.png)

- Create a new `Rmd` file for the Your Turns in the workshop

## Your Turn

![](lorikeets.png)

- Look at the documentation for `economics` data in the `ggplot2` package. 
- Think of 3 questions you could answer using these variables?
- Write these into your `.Rmd` file. 

## Your Turn

![](lorikeets.png)

- Read the documentation for `gapminder` data. 
- Think of 3 questions you could answer using these variables?
- Write these into your `.Rmd` file. 

## Your Turn

![](lorikeets.png)

- Take a look at the `pedestrian sensor` data. 
- Think of 3 questions you could answer using these variables?
- Write these into your `.Rmd` file. 

## Getting Help on the Web

* Reading documentation only gets you so far. What about _finding_ function(s) and/or package(s) to help solve a problem???

* Google! (I usually prefix "CRAN" to my search; others might suggest [http://www.rseek.org/](http://www.rseek.org/)

* Ask your question on a relevant StackExchange outlet such as  [http://stackoverflow.com/](http://stackoverflow.com/) or [http://stats.stackexchange.com/](http://stats.stackexchange.com/)

* It's becoming more and more popular to bundle "vignettes" with a package (__dplyr__ has _awesome_ vignettes)

```{r, eval = FALSE}
browseVignettes("dplyr")
```

## Your Turn

![](lorikeets.png)

1. Read in the OECD PISA data
2. Tabulate the countries (CNT)
3. Extract the values for Australia (AUS) and Shanghai (QCN)
4. Compute the average and standard deviation of the reading scores (PV1READ), for each country

```{r eval=FALSE, echo=FALSE}
student2012.sub <- readRDS("data/student_sub.rds")
table(student2012.sub$CNT)
australia <- student2012.sub[student2012.sub$CNT=="AUS",]
shanghai <- student2012.sub[student2012.sub$CNT=="QCN",]
mean(australia$PV1READ)
sd(australia$PV1READ)
mean(shanghai$PV1READ)
sd(shanghai$PV1READ)
```

## Australian Election Data

This is a current project (joint with Ben Marwick, Rob Hyndman, Heike Hofmann, Carson Sievert, Nathaniel Tomasetti). Code and data are provided to study the electoral maps and system.

- Spatial boundaries of electorates
- Results of the 2013 elections
- 2010 Census data aggregated to electorate level

There is a shiny app that facilitates interactive exploration of the data.

##

<iframe src="https://player.vimeo.com/video/167367369" width="640" height="531" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe> <p><a href="https://vimeo.com/167367369">Exploring the Australian electorate</a> from <a href="https://vimeo.com/user14048736">Di Cook</a> on <a href="https://vimeo.com">Vimeo</a>.</p>

## GRAMMAR

- The grammar of graphics makes the mapping of a data variable to a plot element explicit. 
- This is a HUGE ADVANCE in data visualisation.
- This provides a closer connection between data, plots and models.
- Enables functional definition of a plot, along the lines of any other type of statistic

## Mappings

- Date is mapped to position along the x axis
- Rate is mapped to position along the y axis
- Currency is mapped to colour

## Information Communication

```{r fig.width=6, fig.height=3}
rates <- read_csv("../data/rates.csv")
rates.sub <- select(rates, date, AUD, NZD, GBP)
rates.sub.m <- gather(rates.sub, currency, rate, -date)
ggplot(data=rates.sub.m, aes(x=date, y=rate, colour=currency)) + 
  geom_line() 
```

>- What can you read from this plot? What is the main observation?
>- The cross-rates for AUD and NZD with the USD are similar, $1USD can buy approximately $1.30 of both, but the GBP is lower, and $1USD only buys 2/3 of a GBP. Do we need a plot to know this?

## Communicate Trend: Scale Currencies

```{r fig.width=8, fig.height=4}
rates.sub <- mutate(rates.sub, AUD=scale(AUD), NZD=scale(NZD), 
                    GBP=scale(GBP))
rates.sub$date <- as.Date(rates.sub$date)
rates.sub.m <- gather(rates.sub, currency, rate, -date)
```

##

```{r fig.width=6, fig.height=3}
ggplot(data=rates.sub.m, aes(x=date, y=rate, colour=currency)) +
         geom_line()
```

- Now you can read off the trend: the AUD and NZD trend similarly in this time period, but the GBP is different. The GBP goes down in cross-rate, as the AUD/NZD go up.

## Your Turn

![](lorikeets.png)

In the plot below, how are variables mapped to plot elements?

```{r echo=FALSE, fig.align='center', fig.width=6, fig.height=3}
ggplot(data=rates.sub, aes(x=AUD, y=NZD, colour=date)) + geom_path() + theme(aspect.ratio=1)
```

```{r echo=FALSE, eval=FALSE}
AUD rate is mapped to position along the x axis
NZD rate is mapped to position along the y axis
first differences are mapped to lines
date is mapped to colour of line, date at beginning of line
```

## Adding Marginal Rug Plot

```{r fig.align='center', fig.width=8, fig.height=4}
ggplot(data=rates.sub, aes(x=AUD, y=NZD)) + 
  geom_point(alpha=0.2) + geom_rug(colour="red", alpha=0.3) + 
  theme(aspect.ratio=1)
```

## Other Types of Plots

- bar charts, pie charts
- boxplots, violins, 
- histograms
- density plots
- dotplots

Look up `?geom_histogram` and choose the index for the ggplot2 package. Look at the `geom_` options. There are many! We will only cover the few main ones.

## Type of Variables Suggests Mapping

1. The values of **quantitative** variables should be mapped to **position along a line**, e.g. histogram, scatterplot. Mapping them to colour will yield only rough return of information to the reader. 
2. Categorical variables could be mapped to 
  - colour, if there are few categories,  
  - aggregated and mapped to position along the line, 
  - mapped to angle, if all categories are available.
3. Order is important, and if no natural order available then impose one e.g. using count

## Categorical Variables - Barchart

The social variables of the PISA data include internet usage. This is a subset.

```{r}
internet <- read_csv("../data/internet.csv")
dim(internet)
colnames(internet)
```

## Categorical Variables - Barchart

```{r fig.width=8, fig.height=4}
ggplot(data=internet, aes(x=`Social networks`)) + 
  geom_bar(binwidth=0.5) 
```

## Categorical Variables - Barchart

Simpson's paradox may be in play when there are multiple categorical variables. Need to divide it into basic elements. 

```{r fig.width=6, fig.height=3}
ggplot(data=internet, aes(x=`Social networks`)) + 
  geom_bar(binwidth=0.5) +
  facet_grid(Gender~name)
```

## Categorical Variables - Stacked Barchart

```{r fig.width=8, fig.height=4}
ggplot(data=internet, aes(x=`Social networks`, fill=Gender)) + 
  geom_bar(binwidth=0.5) +
  facet_wrap(~name, ncol=5) + theme(legend.position="bottom")
```

## Categorical Variables - Dodged Bars 

```{r fig.width=8, fig.height=4}
ggplot(data=internet) + 
  geom_bar(aes(x=`Social networks`, fill=Gender),
          position="dodge") +
  facet_wrap(~name, ncol=5) + 
  theme(legend.position="bottom")
```

## Categorical Variables - Piechart

```{r fig.width=8, fig.height=4}
ggplot(data=internet, aes(x=factor(1), fill=factor(`Social networks`))) + 
  geom_bar(width = 1) + scale_x_discrete("") +
  scale_y_continuous("") +
  scale_fill_hue("Social Network Use") +
  coord_polar(theta = "y")
```

Yes, its deliberately made hard to do !

## Quantitative and Categorical - Boxplots

Data are measurements from the National Research Council in the USA, evaluating graduate programs in Statistics. 

```{r}
grad <- read_csv("../data/graduate-programs.csv")
dim(grad)
colnames(grad)
```

##

```{r fig.width=8, fig.height=4}
ggplot(data=grad, aes(x=subject, y=AvGREs)) + 
  geom_boxplot()
```

##

```{r fig.width=8, fig.height=4}
ggplot(data=grad, aes(x=subject, y=AvGREs)) + 
  geom_violin()
```

## Your Turn

![](lorikeets.png)

- Create a side-by-side boxplot of average number of publications by program
- Then answer, "how do the four programs compare in terms of average number of publications?" 

## Next session

- Wrangling your data into shape, 
- Useful graphics, cognitve perception

## Credits

Notes prepared by Di Cook, building on joint workshops with Carson Sievert, Heike Hofmann, Eric Hare, Hadley Wickham.

![](carson2.jpg) ![](heike.jpg) ![](eric.jpg) ![](hadley.jpg)

<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
